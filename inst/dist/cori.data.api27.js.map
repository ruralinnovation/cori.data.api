{"version":3,"file":"cori.data.api27.js","sources":["../../node_modules/d3-array/src/group.js"],"sourcesContent":["import {InternMap} from \"internmap\";\nimport identity from \"./identity.js\";\n\nexport default function group(values, ...keys) {\n  return nest(values, identity, identity, keys);\n}\n\nexport function groups(values, ...keys) {\n  return nest(values, Array.from, identity, keys);\n}\n\nfunction flatten(groups, keys) {\n  for (let i = 1, n = keys.length; i < n; ++i) {\n    groups = groups.flatMap(g => g.pop().map(([key, value]) => [...g, key, value]));\n  }\n  return groups;\n}\n\nexport function flatGroup(values, ...keys) {\n  return flatten(groups(values, ...keys), keys);\n}\n\nexport function flatRollup(values, reduce, ...keys) {\n  return flatten(rollups(values, reduce, ...keys), keys);\n}\n\nexport function rollup(values, reduce, ...keys) {\n  return nest(values, identity, reduce, keys);\n}\n\nexport function rollups(values, reduce, ...keys) {\n  return nest(values, Array.from, reduce, keys);\n}\n\nexport function index(values, ...keys) {\n  return nest(values, identity, unique, keys);\n}\n\nexport function indexes(values, ...keys) {\n  return nest(values, Array.from, unique, keys);\n}\n\nfunction unique(values) {\n  if (values.length !== 1) throw new Error(\"duplicate key\");\n  return values[0];\n}\n\nfunction nest(values, map, reduce, keys) {\n  return (function regroup(values, i) {\n    if (i >= keys.length) return reduce(values);\n    const groups = new InternMap();\n    const keyof = keys[i++];\n    let index = -1;\n    for (const value of values) {\n      const key = keyof(value, ++index, values);\n      const group = groups.get(key);\n      if (group) group.push(value);\n      else groups.set(key, [value]);\n    }\n    for (const [key, values] of groups) {\n      groups.set(key, regroup(values, i));\n    }\n    return map(groups);\n  })(values, 0);\n}\n"],"names":["group","values","keys","nest","identity","map","reduce","regroup","i","groups","InternMap","keyof","index","value","key"],"mappings":";;;;;;;;AAGe,SAASA,EAAMC,MAAWC,GAAM;AAC7C,SAAOC,EAAKF,GAAQG,GAAUA,GAAUF,CAAI;AAC9C;AA0CA,SAASC,EAAKF,GAAQI,GAAKC,GAAQJ,GAAM;AACvC,SAAQ,SAASK,EAAQN,GAAQO,GAAG;AAClC,QAAIA,KAAKN,EAAK;AAAQ,aAAOI,EAAOL,CAAM;AAC1C,UAAMQ,IAAS,IAAIC,KACbC,IAAQT,EAAKM,GAAG;AACtB,QAAII,IAAQ;AACZ,eAAWC,KAASZ,GAAQ;AAC1B,YAAMa,IAAMH,EAAME,GAAO,EAAED,GAAOX,CAAM,GAClCD,IAAQS,EAAO,IAAIK,CAAG;AAC5B,MAAId,IAAOA,EAAM,KAAKa,CAAK,IACtBJ,EAAO,IAAIK,GAAK,CAACD,CAAK,CAAC;AAAA,IAC7B;AACD,eAAW,CAACC,GAAKb,CAAM,KAAKQ;AAC1B,MAAAA,EAAO,IAAIK,GAAKP,EAAQN,GAAQO,CAAC,CAAC;AAEpC,WAAOH,EAAII,CAAM;AAAA,EACrB,EAAKR,GAAQ,CAAC;AACd;","x_google_ignoreList":[0]}