/*
 * CORI Data API Package
 * {@link https://github.com/ruralinnovation/cori.data.api}
 * @copyright Rural Innovation Strategies, Inc.
 * @license ISC
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("aws-amplify");const e=new t.Logger("AmplifyService");exports.default=class{constructor(){}static configure(e,r){return"function"==typeof r?r(t.Amplify.configure(e)):t.Amplify.configure(e),e}static federatedLogin(r){return console.log(`Attempt federated login ${r?"with provider: "+r:""} ...`),e.info(`Attempt federated login ${r?"with provider: "+r:""} ...`),r?t.Auth.federatedSignIn({provider:r}):t.Auth.federatedSignIn()}static async getAccessJwtToken(){try{const e=await t.Auth.currentSession();return e.getAccessToken().getJwtToken()}catch(t){throw e.error("Cannot get JWT Token because Amplify is not currently authenticated: ",t),t}}static async getIdToken(){try{const e=await t.Auth.currentSession();return e.getIdToken().getJwtToken()}catch(t){throw e.error("Unable to get ID token",t),t}}static async getClaims(){try{const e=await t.Auth.currentSession(),r=e.getIdToken().decodePayload();return{username:r["cognito:username"],email:r.email,groups:r["cognito:groups"]?r["cognito:groups"]:[]}}catch(t){throw e.error("Cannot get claims because Amplify is not currently authenticated: ",t),t}}static async getCredentials(){try{const e=await t.Auth.currentUserCredentials();return t.Auth.essentialCredentials(e)}catch(t){throw e.error("Error retrieving credentials: ",t),t}}static async getUserId(r){let n=null;try{const e=await t.Auth.currentAuthenticatedUser();"function"==typeof r&&r(e),n=e.hasOwnProperty("identities")&&e.identities.length>0?e.identities[0].userId:e.email}catch(t){e.error("Amplify is not currently authenticated: ",t)}return n}static async isAuthenticated(r){try{const e=await t.Auth.currentAuthenticatedUser();return"function"==typeof r&&r(e),!0}catch(t){return e.error("Amplify is not currently authenticated: ",t),!1}}static async setHubListener(r){e.info("Set Hub listener called with current updateAuthUser:",JSON.stringify(r));try{t.Hub.listen("auth",(t=>{let{payload:{event:n,data:i}}=t;if(e.info("Call Hub listener called with event:",n),"signIn"===n)this.getClaims().then((t=>{t?r({username:t.username,userType:"user",groups:t.groups,email:t.email}):this.isAuthenticated()?e.info("No authenticated claims found"):e.info("Amplify is not currently authenticated")})).catch((t=>{e.error("Cannot get claims because Amplify is not currently authenticated: ",t)}));else e.info("Sign out")}))}catch(t){e.error("Cannot get claims: ",t)}}};
