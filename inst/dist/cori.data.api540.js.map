{"version":3,"file":"cori.data.api540.js","sources":["../../node_modules/arquero/src/engine/lookup.js"],"sourcesContent":["import { rowLookup } from './join/lookup';\nimport { aggregateGet } from './reduce/util';\nimport columnSet from '../table/column-set';\nimport NULL from '../util/null';\nimport concat from '../util/concat';\nimport unroll from '../util/unroll';\n\nexport default function(tableL, tableR, [keyL, keyR], { names, exprs, ops }) {\n  // instantiate output data\n  const cols = columnSet(tableL);\n  const total = tableL.totalRows();\n  names.forEach(name => cols.add(name, Array(total).fill(NULL)));\n\n  // build lookup table\n  const lut = rowLookup(tableR, keyR);\n\n  // generate setter function for lookup match\n  const set = unroll(\n    ['lr', 'rr', 'data'],\n    '{' + concat(names, (_, i) => `_[${i}][lr] = $[${i}](rr, data);`) + '}',\n    names.map(name => cols.data[name]),\n    aggregateGet(tableR, ops, exprs)\n  );\n\n  // find matching rows, set values on match\n  const dataR = tableR.data();\n  tableL.scan((lrow, data) => {\n    const rrow = lut.get(keyL(lrow, data));\n    if (rrow >= 0) set(lrow, rrow, dataR);\n  });\n\n  return tableL.create(cols);\n}"],"names":["_lookup","tableL","tableR","keyL","keyR","names","exprs","ops","cols","columnSet","total","name","NULL","lut","rowLookup","set","unroll","concat","_","i","aggregateGet","dataR","lrow","data","rrow"],"mappings":";;;;;;;;;;;;AAOe,SAAAA,EAASC,GAAQC,GAAQ,CAACC,GAAMC,CAAI,GAAG,EAAE,OAAAC,GAAO,OAAAC,GAAO,KAAAC,KAAO;AAE3E,QAAMC,IAAOC,EAAUR,CAAM,GACvBS,IAAQT,EAAO;AACrB,EAAAI,EAAM,QAAQ,CAAAM,MAAQH,EAAK,IAAIG,GAAM,MAAMD,CAAK,EAAE,KAAKE,CAAI,CAAC,CAAC;AAG7D,QAAMC,IAAMC,EAAUZ,GAAQE,CAAI,GAG5BW,IAAMC;AAAA,IACV,CAAC,MAAM,MAAM,MAAM;AAAA,IACnB,MAAMC,EAAOZ,GAAO,CAACa,GAAGC,MAAM,KAAKA,CAAC,aAAaA,CAAC,cAAc,IAAI;AAAA,IACpEd,EAAM,IAAI,CAAAM,MAAQH,EAAK,KAAKG,CAAI,CAAC;AAAA,IACjCS,EAAalB,GAAQK,GAAKD,CAAK;AAAA,EACnC,GAGQe,IAAQnB,EAAO;AACrB,SAAAD,EAAO,KAAK,CAACqB,GAAMC,MAAS;AAC1B,UAAMC,IAAOX,EAAI,IAAIV,EAAKmB,GAAMC,CAAI,CAAC;AACrC,IAAIC,KAAQ,KAAGT,EAAIO,GAAME,GAAMH,CAAK;AAAA,EACxC,CAAG,GAEMpB,EAAO,OAAOO,CAAI;AAC3B;","x_google_ignoreList":[0]}