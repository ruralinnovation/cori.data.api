{"version":3,"file":"cori.data.api534.js","sources":["../../node_modules/arquero/src/engine/groupby.js"],"sourcesContent":["import { aggregateGet } from './reduce/util';\nimport keyFunction from '../util/key-function';\n\nexport default function(table, exprs) {\n  return table.create({\n    groups: createGroups(table, exprs)\n  });\n}\n\nfunction createGroups(table, { names = [], exprs = [], ops = [] }) {\n  const n = names.length;\n  if (n === 0) return null;\n\n  // check for optimized path when grouping by a single field\n  // use pre-calculated groups if available\n  if (n === 1 && !table.isFiltered() && exprs[0].field) {\n    const col = table.column(exprs[0].field);\n    if (col.groups) return col.groups(names);\n  }\n\n  let get = aggregateGet(table, ops, exprs);\n  const getKey = keyFunction(get);\n  const nrows = table.totalRows();\n  const keys = new Uint32Array(nrows);\n  const index = {};\n  const rows = [];\n\n  // inline table scan for performance\n  const data = table.data();\n  const bits = table.mask();\n  if (bits) {\n    for (let i = bits.next(0); i >= 0; i = bits.next(i + 1)) {\n      const key = getKey(i, data) + '';\n      const val = index[key];\n      keys[i] = val != null ? val : (index[key] = rows.push(i) - 1);\n    }\n  } else {\n    for (let i = 0; i < nrows; ++i) {\n      const key = getKey(i, data) + '';\n      const val = index[key];\n      keys[i] = val != null ? val : (index[key] = rows.push(i) - 1);\n    }\n  }\n\n  if (!ops.length) {\n    // capture data in closure, so no interaction with select\n    get = get.map(f => row => f(row, data));\n  }\n\n  return { keys, get, names, rows, size: rows.length };\n}"],"names":["_groupby","table","exprs","createGroups","names","ops","n","col","get","aggregateGet","getKey","keyFunction","nrows","keys","index","rows","data","bits","i","key","val","f","row"],"mappings":";;;;;;;;AAGe,SAAAA,EAASC,GAAOC,GAAO;AACpC,SAAOD,EAAM,OAAO;AAAA,IAClB,QAAQE,EAAaF,GAAOC,CAAK;AAAA,EACrC,CAAG;AACH;AAEA,SAASC,EAAaF,GAAO,EAAE,OAAAG,IAAQ,CAAA,GAAI,OAAAF,IAAQ,CAAE,GAAE,KAAAG,IAAM,CAAA,KAAM;AACjE,QAAMC,IAAIF,EAAM;AAChB,MAAIE,MAAM;AAAG,WAAO;AAIpB,MAAIA,MAAM,KAAK,CAACL,EAAM,WAAU,KAAMC,EAAM,CAAC,EAAE,OAAO;AACpD,UAAMK,IAAMN,EAAM,OAAOC,EAAM,CAAC,EAAE,KAAK;AACvC,QAAIK,EAAI;AAAQ,aAAOA,EAAI,OAAOH,CAAK;AAAA,EACxC;AAED,MAAII,IAAMC,EAAaR,GAAOI,GAAKH,CAAK;AACxC,QAAMQ,IAASC,EAAYH,CAAG,GACxBI,IAAQX,EAAM,aACdY,IAAO,IAAI,YAAYD,CAAK,GAC5BE,IAAQ,CAAA,GACRC,IAAO,CAAA,GAGPC,IAAOf,EAAM,QACbgB,IAAOhB,EAAM;AACnB,MAAIgB;AACF,aAASC,IAAID,EAAK,KAAK,CAAC,GAAGC,KAAK,GAAGA,IAAID,EAAK,KAAKC,IAAI,CAAC,GAAG;AACvD,YAAMC,IAAMT,EAAOQ,GAAGF,CAAI,IAAI,IACxBI,IAAMN,EAAMK,CAAG;AACrB,MAAAN,EAAKK,CAAC,IAAIE,MAAqBN,EAAMK,CAAG,IAAIJ,EAAK,KAAKG,CAAC,IAAI;AAAA,IAC5D;AAAA;AAED,aAASA,IAAI,GAAGA,IAAIN,GAAO,EAAEM,GAAG;AAC9B,YAAMC,IAAMT,EAAOQ,GAAGF,CAAI,IAAI,IACxBI,IAAMN,EAAMK,CAAG;AACrB,MAAAN,EAAKK,CAAC,IAAIE,MAAqBN,EAAMK,CAAG,IAAIJ,EAAK,KAAKG,CAAC,IAAI;AAAA,IAC5D;AAGH,SAAKb,EAAI,WAEPG,IAAMA,EAAI,IAAI,CAAAa,MAAK,CAAAC,MAAOD,EAAEC,GAAKN,CAAI,CAAC,IAGjC,EAAE,MAAAH,GAAM,KAAAL,GAAK,OAAAJ,GAAO,MAAAW,GAAM,MAAMA,EAAK;AAC9C;","x_google_ignoreList":[0]}