{"version":3,"file":"cori.data.api528.js","sources":["../../node_modules/arquero/src/engine/rollup.js"],"sourcesContent":["import { aggregate, groupOutput } from './reduce/util';\nimport columnSet from '../table/column-set';\n\nexport default function(table, { names, exprs, ops }) {\n  // output data\n  const cols = columnSet();\n  const groups = table.groups();\n\n  // write groupby fields to output\n  if (groups) groupOutput(cols, groups);\n\n  // compute and write aggregate output\n  output(names, exprs, groups, aggregate(table, ops), cols);\n\n  // return output table\n  return table.create(cols.new());\n}\n\nfunction output(names, exprs, groups, result = [], cols) {\n  if (!exprs.length) return;\n  const size = groups ? groups.size : 1;\n  const op = (id, row) => result[id][row];\n  const n = names.length;\n\n  for (let i = 0; i < n; ++i) {\n    const get = exprs[i];\n    if (get.field != null) {\n      // if expression is op only, use aggregates directly\n      cols.add(names[i], result[get.field]);\n    } else if (size > 1) {\n      // if multiple groups, evaluate expression for each\n      const col = cols.add(names[i], Array(size));\n      for (let j = 0; j < size; ++j) {\n        col[j] = get(j, null, op);\n      }\n    } else {\n      // if only one group, no need to loop\n      cols.add(names[i], [ get(0, null, op) ]);\n    }\n  }\n}"],"names":["_rollup","table","names","exprs","ops","cols","columnSet","groups","groupOutput","output","aggregate","result","size","op","id","row","n","i","get","col","j"],"mappings":";;;;;;;;AAGe,SAAQA,EAACC,GAAO,EAAE,OAAAC,GAAO,OAAAC,GAAO,KAAAC,EAAG,GAAI;AAEpD,QAAMC,IAAOC,KACPC,IAASN,EAAM;AAGrB,SAAIM,KAAQC,EAAYH,GAAME,CAAM,GAGpCE,EAAOP,GAAOC,GAAOI,GAAQG,EAAUT,GAAOG,CAAG,GAAGC,CAAI,GAGjDJ,EAAM,OAAOI,EAAK,IAAK,CAAA;AAChC;AAEA,SAASI,EAAOP,GAAOC,GAAOI,GAAQI,IAAS,CAAE,GAAEN,GAAM;AACvD,MAAI,CAACF,EAAM;AAAQ;AACnB,QAAMS,IAAOL,IAASA,EAAO,OAAO,GAC9BM,IAAK,CAACC,GAAIC,MAAQJ,EAAOG,CAAE,EAAEC,CAAG,GAChCC,IAAId,EAAM;AAEhB,WAASe,IAAI,GAAGA,IAAID,GAAG,EAAEC,GAAG;AAC1B,UAAMC,IAAMf,EAAMc,CAAC;AACnB,QAAIC,EAAI,SAAS;AAEf,MAAAb,EAAK,IAAIH,EAAMe,CAAC,GAAGN,EAAOO,EAAI,KAAK,CAAC;AAAA,aAC3BN,IAAO,GAAG;AAEnB,YAAMO,IAAMd,EAAK,IAAIH,EAAMe,CAAC,GAAG,MAAML,CAAI,CAAC;AAC1C,eAASQ,IAAI,GAAGA,IAAIR,GAAM,EAAEQ;AAC1B,QAAAD,EAAIC,CAAC,IAAIF,EAAIE,GAAG,MAAMP,CAAE;AAAA,IAEhC;AAEM,MAAAR,EAAK,IAAIH,EAAMe,CAAC,GAAG,CAAEC,EAAI,GAAG,MAAML,CAAE,CAAC,CAAE;AAAA,EAE1C;AACH;","x_google_ignoreList":[0]}