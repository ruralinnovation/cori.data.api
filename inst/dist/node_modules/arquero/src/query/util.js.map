{"version":3,"file":"util.js","sources":["../../../../../../node_modules/arquero/src/query/util.js"],"sourcesContent":["import desc from '../helpers/desc';\nimport field from '../helpers/field';\nimport rolling from '../helpers/rolling';\nimport { all, matches, not, range } from '../helpers/selection';\nimport Query from './query';\nimport error from '../util/error';\nimport isArray from '../util/is-array';\nimport isFunction from '../util/is-function';\nimport isNumber from '../util/is-number';\nimport isObject from '../util/is-object';\nimport isString from '../util/is-string';\nimport map from '../util/map-object';\nimport toArray from '../util/to-array';\n\nfunction func(expr) {\n  const f = d => d;\n  f.toString = () => expr;\n  return f;\n}\n\nexport function getTable(catalog, ref) {\n  ref = ref && isFunction(ref.query) ? ref.query() : ref;\n  return ref && isFunction(ref.evaluate)\n    ? ref.evaluate(null, catalog)\n    : catalog(ref);\n}\n\nexport function isSelection(value) {\n  return isObject(value) && (\n    isArray(value.all) ||\n    isArray(value.matches) ||\n    isArray(value.not) ||\n    isArray(value.range)\n  );\n}\n\nexport function toObject(value) {\n  return value && isFunction(value.toObject) ? value.toObject()\n    : isFunction(value) ? { expr: String(value), func: true }\n    : isArray(value) ? value.map(toObject)\n    : isObject(value) ? map(value, _ => toObject(_))\n    : value;\n}\n\nexport function fromObject(value) {\n  return isArray(value) ? value.map(fromObject)\n    : !isObject(value) ? value\n    : isArray(value.verbs) ? Query.from(value)\n    : isArray(value.all) ? all()\n    : isArray(value.range) ? range(...value.range)\n    : isArray(value.match) ? matches(RegExp(...value.match))\n    : isArray(value.not) ? not(value.not.map(toObject))\n    : fromExprObject(value);\n}\n\nfunction fromExprObject(value) {\n  let output = value;\n  let expr = value.expr;\n\n  if (expr != null) {\n    if (value.field === true) {\n      output = expr = field(expr);\n    } else if (value.func === true) {\n      output = expr = func(expr);\n    }\n\n    if (isObject(value.window)) {\n      const { frame, peers } = value.window;\n      output = expr = rolling(expr, frame, peers);\n    }\n\n    if (value.desc === true) {\n      output = desc(expr);\n    }\n  }\n\n  return value === output\n    ? map(value, _ => fromObject(_))\n    : output;\n}\n\nexport function joinKeys(keys) {\n  return isArray(keys) ? keys.map(parseJoinKeys)\n    : keys;\n}\n\nfunction parseJoinKeys(keys) {\n  const list = [];\n\n  toArray(keys).forEach(param => {\n    isNumber(param) ? list.push(param)\n      : isString(param) ? list.push(field(param, null))\n      : isObject(param) && param.expr ? list.push(param)\n      : isFunction(param) ? list.push(param)\n      : error(`Invalid key value: ${param+''}`);\n  });\n\n  return list;\n}\n\nexport function joinValues(values) {\n  return isArray(values)\n    ? values.map(parseJoinValues)\n    : values;\n}\n\nfunction parseJoinValues(values, index) {\n  return index < 2 ? toArray(values) : values;\n}\n\nexport function orderbyKeys(keys) {\n  const list = [];\n\n  keys.forEach(param => {\n    const expr = param.expr != null ? param.expr : param;\n    if (isObject(expr) && !isFunction(expr)) {\n      for (const key in expr) {\n        list.push(expr[key]);\n      }\n    } else {\n      param = isNumber(expr) ? expr\n        : isString(expr) ? field(param)\n        : isFunction(expr) ? param\n        : error(`Invalid orderby field: ${param+''}`);\n      list.push(param);\n    }\n  });\n\n  return list;\n}"],"names":[],"mappings":"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","x_google_ignoreList":[0]}