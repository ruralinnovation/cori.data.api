{"version":3,"file":"lookup.js","sources":["../../../../../../node_modules/arquero/src/engine/lookup.js"],"sourcesContent":["import { rowLookup } from './join/lookup';\nimport { aggregateGet } from './reduce/util';\nimport columnSet from '../table/column-set';\nimport NULL from '../util/null';\nimport concat from '../util/concat';\nimport unroll from '../util/unroll';\n\nexport default function(tableL, tableR, [keyL, keyR], { names, exprs, ops }) {\n  // instantiate output data\n  const cols = columnSet(tableL);\n  const total = tableL.totalRows();\n  names.forEach(name => cols.add(name, Array(total).fill(NULL)));\n\n  // build lookup table\n  const lut = rowLookup(tableR, keyR);\n\n  // generate setter function for lookup match\n  const set = unroll(\n    ['lr', 'rr', 'data'],\n    '{' + concat(names, (_, i) => `_[${i}][lr] = $[${i}](rr, data);`) + '}',\n    names.map(name => cols.data[name]),\n    aggregateGet(tableR, ops, exprs)\n  );\n\n  // find matching rows, set values on match\n  const dataR = tableR.data();\n  tableL.scan((lrow, data) => {\n    const rrow = lut.get(keyL(lrow, data));\n    if (rrow >= 0) set(lrow, rrow, dataR);\n  });\n\n  return tableL.create(cols);\n}"],"names":[],"mappings":";;;;;;;;;;;;;AAOe,gBAAQ,CAAC,MAAM,EAAE,MAAM,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,EAAE;AAC7E;AACA,EAAE,MAAM,IAAI,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC;AACjC,EAAE,MAAM,KAAK,GAAG,MAAM,CAAC,SAAS,EAAE,CAAC;AACnC,EAAE,KAAK,CAAC,OAAO,CAAC,IAAI,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACjE;AACA;AACA,EAAE,MAAM,GAAG,GAAG,SAAS,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;AACtC;AACA;AACA,EAAE,MAAM,GAAG,GAAG,MAAM;AACpB,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,MAAM,CAAC;AACxB,IAAI,GAAG,GAAG,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC,UAAU,EAAE,CAAC,CAAC,YAAY,CAAC,CAAC,GAAG,GAAG;AAC3E,IAAI,KAAK,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACtC,IAAI,YAAY,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,CAAC;AACpC,GAAG,CAAC;AACJ;AACA;AACA,EAAE,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC;AAC9B,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,IAAI,KAAK;AAC9B,IAAI,MAAM,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;AAC3C,IAAI,IAAI,IAAI,IAAI,CAAC,EAAE,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;AAC1C,GAAG,CAAC,CAAC;AACL;AACA,EAAE,OAAO,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AAC7B;;;;","x_google_ignoreList":[0]}