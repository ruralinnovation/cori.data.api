{"version":3,"file":"cori.data.api308.js","sources":["../../node_modules/arquero/src/arrow/builder/dictionary-builder.js"],"sourcesContent":["import utf8Builder from './utf8-builder';\nimport { array, arrowVector } from './util';\n\nexport default function(type, length) {\n  const values = [];\n  const data = array(type.indices.ArrayType, length);\n  const keys = Object.create(null);\n\n  let next = -1;\n  let strlen = 0;\n\n  return {\n    set(value, index) {\n      const v = String(value);\n      let k = keys[v];\n      if (k === undefined) {\n        strlen += v.length;\n        keys[v] = k = ++next;\n        values.push(v);\n      }\n      data[index] = k;\n    },\n    data: () => ({\n      type,\n      length,\n      buffers: [null, data],\n      dict: dictionary(type.dictionary, values, strlen)\n    })\n  };\n}\n\nfunction dictionary(type, values, strlen) {\n  const b = utf8Builder(type, values.length, strlen);\n  values.forEach(b.set);\n  return arrowVector(b.data());\n}"],"names":["dictionaryBuilder","type","length","values","data","array","keys","next","strlen","value","index","v","k","dictionary","b","utf8Builder","arrowVector"],"mappings":";;;;;;;;AAGe,SAAAA,EAASC,GAAMC,GAAQ;AACpC,QAAMC,IAAS,CAAA,GACTC,IAAOC,EAAMJ,EAAK,QAAQ,WAAWC,CAAM,GAC3CI,IAAO,uBAAO,OAAO,IAAI;AAE/B,MAAIC,IAAO,IACPC,IAAS;AAEb,SAAO;AAAA,IACL,IAAIC,GAAOC,GAAO;AAChB,YAAMC,IAAI,OAAOF,CAAK;AACtB,UAAIG,IAAIN,EAAKK,CAAC;AACd,MAAIC,MAAM,WACRJ,KAAUG,EAAE,QACZL,EAAKK,CAAC,IAAIC,IAAI,EAAEL,GAChBJ,EAAO,KAAKQ,CAAC,IAEfP,EAAKM,CAAK,IAAIE;AAAA,IACf;AAAA,IACD,MAAM,OAAO;AAAA,MACX,MAAAX;AAAA,MACA,QAAAC;AAAA,MACA,SAAS,CAAC,MAAME,CAAI;AAAA,MACpB,MAAMS,EAAWZ,EAAK,YAAYE,GAAQK,CAAM;AAAA,IACtD;AAAA,EACA;AACA;AAEA,SAASK,EAAWZ,GAAME,GAAQK,GAAQ;AACxC,QAAMM,IAAIC,EAAYd,GAAME,EAAO,QAAQK,CAAM;AACjD,SAAAL,EAAO,QAAQW,EAAE,GAAG,GACbE,EAAYF,EAAE,KAAI,CAAE;AAC7B;","x_google_ignoreList":[0]}