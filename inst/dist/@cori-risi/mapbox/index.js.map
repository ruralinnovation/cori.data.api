{"version":3,"file":"index.js","sources":["../../../../lib/@cori-risi/mapbox/index.ts"],"sourcesContent":["import axios from \"axios\";\n\n/**\n * This function is a simple wrapper around the [Mapbox Geocoding API](https://docs.mapbox.com/api/search/geocoding/)\n *\n * @param api_key - The Mapbox API (public) token (string)\n * @param text - The search terms (string) that will be passed at the query to the API request\n *\n * ```ts\n * import { mapboxGeocode } from \"@cori-risi/cori.data.api\";\n *\n * // ...\n *\n * const relevant_features = await mapboxGeocode(mapbox_access_token, text);\n *\n * ```\n * */\nexport async function mapboxGeocode (api_key: string, text: string) {\n\n    const search_request = 'https://api.mapbox.com/search/geocode/v6/forward'\n\n    console.log(\"MAPBOX API TOKEN: \", api_key);\n\n    const res = await axios.get(search_request,\n        {\n            params: {\n                access_token: api_key,\n                q: text\n            }\n        }\n    )\n\n    console.log(\"MAPBOX API: \", res);\n\n    const found_features = res.data.features\n        .filter((f: any) => (f.hasOwnProperty(\"geometry\") && f.geometry.type === \"Point\"));\n\n    console.log(\"found_features: \", found_features);\n\n    return found_features\n        .filter((item: any) => {\n            return item.hasOwnProperty(\"properties\")\n                && item[\"properties\"].hasOwnProperty(\"full_address\")\n                && item[\"properties\"].hasOwnProperty(\"context\")\n                && item[\"properties\"][\"context\"].hasOwnProperty(\"country\")\n                && item[\"properties\"][\"context\"][\"country\"].hasOwnProperty(\"country_code\")\n                && item[\"properties\"][\"context\"][\"country\"][\"country_code\"]\n                    .match(/(?:US|AS|GU|MP|PR|VI)/) !== null\n                && \"region\" in item[\"properties\"][\"context\"]\n                && \"postcode\" in item[\"properties\"][\"context\"];\n        })\n        .map((item: any) => {\n            console.log(item);\n            const properties = item[\"properties\"];\n            properties[\"label\"] = item[\"properties\"][\"full_address\"];\n            properties['props'] = JSON.stringify(properties);\n\n            return {\n                ...item,\n                properties\n            };\n        });\n}\n"],"names":[],"mappings":";;;;;;;;;AAEA;;;;;;;;;;;;;;AAcK;AACiB,SAAA,aAAa,CAAE,OAAe,EAAE,IAAY,EAAA;;QAE9D,MAAM,cAAc,GAAG,kDAAkD;AAEzE,QAAA,OAAO,CAAC,GAAG,CAAC,oBAAoB,EAAE,OAAO,CAAC;QAE1C,MAAM,GAAG,GAAG,MAAM,KAAK,CAAC,GAAG,CAAC,cAAc,EACtC;AACI,YAAA,MAAM,EAAE;AACJ,gBAAA,YAAY,EAAE,OAAO;AACrB,gBAAA,CAAC,EAAE;AACN;AACJ,SAAA,CACJ;AAED,QAAA,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,GAAG,CAAC;AAEhC,QAAA,MAAM,cAAc,GAAG,GAAG,CAAC,IAAI,CAAC;aAC3B,MAAM,CAAC,CAAC,CAAM,MAAM,CAAC,CAAC,cAAc,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,IAAI,KAAK,OAAO,CAAC,CAAC;AAEtF,QAAA,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,cAAc,CAAC;AAE/C,QAAA,OAAO;AACF,aAAA,MAAM,CAAC,CAAC,IAAS,KAAI;AAClB,YAAA,OAAO,IAAI,CAAC,cAAc,CAAC,YAAY;AAChC,mBAAA,IAAI,CAAC,YAAY,CAAC,CAAC,cAAc,CAAC,cAAc;AAChD,mBAAA,IAAI,CAAC,YAAY,CAAC,CAAC,cAAc,CAAC,SAAS;mBAC3C,IAAI,CAAC,YAAY,CAAC,CAAC,SAAS,CAAC,CAAC,cAAc,CAAC,SAAS;AACtD,mBAAA,IAAI,CAAC,YAAY,CAAC,CAAC,SAAS,CAAC,CAAC,SAAS,CAAC,CAAC,cAAc,CAAC,cAAc;mBACtE,IAAI,CAAC,YAAY,CAAC,CAAC,SAAS,CAAC,CAAC,SAAS,CAAC,CAAC,cAAc;AACrD,qBAAA,KAAK,CAAC,uBAAuB,CAAC,KAAK;AACrC,mBAAA,QAAQ,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC,SAAS;mBACxC,UAAU,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC,SAAS,CAAC;AACtD,SAAC;AACA,aAAA,GAAG,CAAC,CAAC,IAAS,KAAI;AACf,YAAA,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC;AACjB,YAAA,MAAM,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC;YACrC,UAAU,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,cAAc,CAAC;YACxD,UAAU,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC;YAEhD,OACO,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,EAAA,EAAA,IAAI,CACP,EAAA,EAAA,UAAU,EACZ,CAAA;AACN,SAAC,CAAC;KACT,CAAA;AAAA;;;;"}